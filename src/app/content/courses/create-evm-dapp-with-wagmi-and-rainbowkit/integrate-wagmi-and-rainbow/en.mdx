import { ArticleSection } from "../../../../components/ArticleSection/ArticleSection";

# Integrating Wagmi V2 and RainbowKit in Next.js: A Comprehensive Guide

Welcome to the forefront of Web3/Frontend development, where we integrate **Wagmi V2** alongside **RainbowKit** for seamless wallet connection and advanced features in a robust dApp.

In this guide, we'll explore how to implement and optimize wallet functionalities within your **Next.js** project. Whether you're transitioning from Wagmi V1 or using Wagmi V2 for the first time, this article will help you elevate user experiences and streamline wallet interactions.

**Part 1** covers the essentials: establishing wallet connections and fetching user data such as addresses, network details, balances, and ENS names.

---

<ArticleSection name="Create the Project" id="create-project" level="h2" />

```bash
npx create-next-app@latest my-project --typescript --eslint
```

---

<ArticleSection name="Add Wagmi and Dependencies" id="add-wagmi" level="h2" />

Install the required packages:

```bash
yarn add wagmi viem@2.x @tanstack/react-query
```

- **Viem** — TypeScript interface for Ethereum; handles blockchain operations.
- **TanStack Query** — Async state manager for requests, caching, and more.

---

<ArticleSection name="Install RainbowKit" id="install-rainbowkit" level="h2" />

```bash
yarn add @rainbow-me/rainbowkit
```

---

<ArticleSection name="Create Wagmi Config" id="create-config" level="h2" />

Create and export a config using `getDefaultConfig` in `lib/config.ts`:

```typescript
'use client';

import { http, createStorage, cookieStorage } from 'wagmi';
import { sepolia, bscTestnet, blastSepolia } from 'wagmi/chains';
import { Chain, getDefaultConfig } from '@rainbow-me/rainbowkit';

const projectId = ''; // Your WalletConnect Cloud project ID

const supportedChains: Chain[] = [sepolia, bscTestnet, blastSepolia];

export const config = getDefaultConfig({
  appName: 'WalletConnection',
  projectId,
  chains: supportedChains as any,
  ssr: true,
  storage: createStorage({
    storage: cookieStorage,
  }),
  transports: supportedChains.reduce(
    (obj, chain) => ({ ...obj, [chain.id]: http() }),
    {}
  ),
});
```

**Notes:**

- This example uses **Sepolia**, **BscTestnet**, and **Blast Sepolia** in `supportedChains`.
- **SSR:** Wagmi uses client-side storage by default, which can cause issues with Next.js. Setting `ssr: true` hydrates data on the client after the initial render.
- **cookieStorage:** Stores Wagmi data in browser cookies for persistence across page refreshes.
- **transports:** The `reduce` builds a `transports` object (e.g. `[chain.id]: http()`) for HTTP requests to blockchain nodes.

See the [createConfig docs](https://wagmi.sh/react/api/createConfig) for more options.

---

<ArticleSection name="Wrap App in Providers" id="wrap-providers" level="h2" />

Wrap the app in **WagmiProvider** and pass your config. In Wagmi V2, you no longer pass `chains` to `<RainbowKitProvider>`. Inside **WagmiProvider**, add **QueryClientProvider** from TanStack Query with a new `QueryClient` instance.

Create a dedicated client component for providers so SSR-safe code stays in Server Components.

In `app/providers.tsx`:

```typescript
"use client";

import { WagmiProvider } from "wagmi";
import { RainbowKitProvider, darkTheme } from "@rainbow-me/rainbowkit";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";

import { config } from "@/lib/config";

const queryClient = new QueryClient();

type Props = {
  children: React.ReactNode;
};

export default function Providers({ children }: Props) {
  return (
    <WagmiProvider config={config}>
      <QueryClientProvider client={queryClient}>
        <RainbowKitProvider
          theme={darkTheme({
            accentColor: "#0E76FD",
            accentColorForeground: "white",
            borderRadius: "large",
            fontStack: "system",
            overlayBlur: "small",
          })}
        >
          {children}
        </RainbowKitProvider>
      </QueryClientProvider>
    </WagmiProvider>
  );
}
```

The component is marked `"use client"` because it uses **WagmiProvider**, **QueryClientProvider**, and **RainbowKitProvider**, which depend on browser APIs. Importing it from `layout.tsx` (a Server Component) ensures these run only on the client after hydration, improving initial load.

---

<ArticleSection name="Import Providers in Layout" id="import-providers" level="h2" />

In `app/layout.tsx`:

```typescript
import "./globals.css";
import "@rainbow-me/rainbowkit/styles.css";

import { Inter } from "next/font/google";
import Providers from "./providers";

const inter = Inter({ subsets: ["latin"] });

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body className={inter.className}>
        <Providers>{children}</Providers>
      </body>
    </html>
  );
}
```

---

<ArticleSection name="Cookie Hydration for SSR" id="cookie-hydration" level="h2" />

To persist Wagmi’s cookie data across page loads in Next.js:

1. Read the cookie from request headers in your Server Component (`app/layout.tsx`).
2. Use **cookieToInitialState** to convert it for Wagmi.
3. Pass this initial state into **WagmiProvider** in your client `Providers` component.

**In `app/layout.tsx`**, add:

```typescript
import { headers } from "next/headers";

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  const cookie = headers().get("cookie");

  return (
    <html lang="en">
      <body className={inter.className}>
        <Providers cookie={cookie}>{children}</Providers>
      </body>
    </html>
  );
}
```

**In `app/providers.tsx`**, update to accept and use the cookie:

```typescript
"use client";

import { WagmiProvider, cookieToInitialState } from "wagmi";
// ... other imports

type Props = {
  children: React.ReactNode;
  cookie?: string | null;
};

export default function Providers({ children, cookie }: Props) {
  const initialState = cookieToInitialState(config, cookie);

  return (
    <WagmiProvider config={config} initialState={initialState}>
      <QueryClientProvider client={queryClient}>
        <RainbowKitProvider theme={...}>
          {children}
        </RainbowKitProvider>
      </QueryClientProvider>
    </WagmiProvider>
  );
}
```

Components inside these providers can now use Wagmi React hooks with hydrated state.

---

<ArticleSection name="Connect Button Component" id="connect-button" level="h2" />

In `app/components/connectButton.tsx`:

```typescript
"use client";

import { useEffect, useRef } from "react";
import {
  useConnectModal,
  useAccountModal,
  useChainModal,
} from "@rainbow-me/rainbowkit";
import { useAccount, useDisconnect } from "wagmi";
import { emojiAvatarForAddress } from "@/lib/emojiAvatarForAddress";

export const ConnectBtn = () => {
  const { isConnecting, address, isConnected, chain } = useAccount();
  const { color: backgroundColor, emoji } = emojiAvatarForAddress(
    address ?? ""
  );

  const { openConnectModal } = useConnectModal();
  const { openAccountModal } = useAccountModal();
  const { openChainModal } = useChainModal();
  const { disconnect } = useDisconnect();

  const isMounted = useRef(false);

  useEffect(() => {
    isMounted.current = true;
  }, []);

  if (!isConnected) {
    return (
      <button
        className="btn"
        onClick={openConnectModal}
        disabled={isConnecting}
      >
        {isConnecting ? "Connecting..." : "Connect your wallet"}
      </button>
    );
  }

  if (isConnected && !chain) {
    return (
      <button className="btn" onClick={openChainModal}>
        Wrong network
      </button>
    );
  }

  return (
    <div className="max-w-5xl w-full flex items-center justify-between">
      <div
        className="flex justify-center items-center px-4 py-2 border border-neutral-700 bg-neutral-800/30 rounded-xl font-mono font-bold gap-x-2 cursor-pointer"
        onClick={async () => openAccountModal?.()}
      >
        <div
          role="button"
          tabIndex={1}
          className="h-8 w-8 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden"
          style={{
            backgroundColor,
            boxShadow: "0px 2px 2px 0px rgba(81, 98, 255, 0.20)",
          }}
        >
          {emoji}
        </div>
        <p>Account</p>
      </div>
      <button className="btn" onClick={openChainModal}>
        Switch Networks
      </button>
    </div>
  );
};
```

**Hooks used:**

- **useConnectModal, useAccountModal, useChainModal** — RainbowKit hooks that open modals for connecting wallets, managing accounts, and switching networks.
- **useAccount, useDisconnect** — Wagmi hooks for connected account info and disconnecting.
- **emojiAvatarForAddress** — Custom helper (e.g. in `lib/emojiAvatarForAddress`) that returns an emoji avatar from the wallet address.

This component handles the wallet connection flow: connect, wrong network, and account/network switching.

---

<ArticleSection name="Profile Component" id="profile-component" level="h2" />

In `app/components/profile.tsx`:

```typescript
"use client";

import { useAccount, useBalance, useEnsName } from "wagmi";
import { middleEllipsis } from "@/lib/utils";
import { formatUnits } from "viem";

export default function Profile() {
  const { address, chain } = useAccount();

  const { data } = useBalance({
    address,
  });

  const ens = useEnsName({
    address,
  });

  return (
    <div className="mb-32 grid text-center lg:max-w-5xl lg:w-full lg:mb-0 lg:grid-cols-4 lg:text-left">
      <div className="group rounded-lg border border-transparent px-5 py-4 transition-colors hover:border-gray-300 hover:bg-gray-100 hover:dark:border-neutral-700 hover:dark:bg-neutral-800/30">
        <h2 className="mb-3 text-2xl font-semibold">Wallet address</h2>
        <p className="m-0 w-[30ch] text-sm opacity-50">
          {middleEllipsis(address as string, 12) || ""}
        </p>
      </div>

      <div className="group rounded-lg border border-transparent px-5 py-4 transition-colors hover:border-gray-300 hover:bg-gray-100 hover:dark:border-neutral-700 hover:dark:bg-neutral-800/30">
        <h2 className="mb-3 text-2xl font-semibold">Network</h2>
        <p className="m-0 max-w-[30ch] text-sm opacity-50">
          {chain?.name || ""}
        </p>
      </div>

      <div className="group rounded-lg border border-transparent px-5 py-4 transition-colors hover:border-gray-300 hover:bg-gray-100 hover:dark:border-neutral-700 hover:dark:bg-neutral-800/30">
        <h2 className="mb-3 text-2xl font-semibold">Balance</h2>
        <div className="m-0 max-w-[30ch] text-sm opacity-50">
          {data ? (
            <p>
              {Number(formatUnits(data.value, data.decimals)).toFixed(4)}{" "}
              {data.symbol}
            </p>
          ) : (
            <div />
          )}
        </div>
      </div>

      <div className="group rounded-lg border border-transparent px-5 py-4 transition-colors hover:border-gray-300 hover:bg-gray-100 hover:dark:border-neutral-700 hover:dark:bg-neutral-800/30">
        <h2 className="mb-3 text-2xl font-semibold">EnsName</h2>
        <p className="m-0 max-w-[30ch] text-sm opacity-50 text-balance">
          {ens.data || ""}
        </p>
      </div>
    </div>
  );
}
```

**Helpers:**

- **middleEllipsis** (e.g. in `lib/utils`) — Truncates long addresses in the middle for readability.
- **formatUnits** (viem) — Converts raw balance (e.g. wei) to a human-readable value with decimals.

The component uses **useAccount**, **useBalance**, and **useEnsName** to show wallet address, network, balance, and ENS name.

---

<ArticleSection name="Wire Up the Page" id="wire-up-page" level="h2" />

Import **ConnectBtn** and **Profile** in `app/page.tsx`:

```typescript
"use client";

import Image from "next/image";
import { ConnectBtn } from "./components/connectButton";
import Profile from "./components/profile";

export default function Home() {
  return (
    <main className="flex min-h-screen flex-col items-center justify-between p-24">
      <div className="z-10 max-w-5xl w-full items-center justify-between font-mono text-sm lg:flex">
        <ConnectBtn />
      </div>

      <div className="relative flex place-items-center before:absolute before:h-[300px] before:w-full sm:before:w-[480px] before:-translate-x-1/2 before:rounded-full before:bg-gradient-radial before:from-white before:to-transparent before:blur-2xl before:content-[''] after:absolute after:-z-20 after:h-[180px] after:w-full sm:after:w-[240px] after:translate-x-1/3 after:bg-gradient-conic after:from-sky-200 after:via-blue-200 after:blur-2xl after:content-[''] before:dark:bg-gradient-to-br before:dark:from-transparent before:dark:to-blue-700 before:dark:opacity-10 after:dark:from-sky-900 after:dark:via-[#0141ff] after:dark:opacity-40 before:lg:h-[360px] z-[-1]">
        <Image
          className="relative dark:drop-shadow-[0_0_0.3rem_#ffffff70] dark:invert"
          src="/next.svg"
          alt="Next.js Logo"
          width={180}
          height={37}
          priority
        />
      </div>

      <Profile />
    </main>
  );
}
```

---

<ArticleSection name="Conclusion" id="conclusion" level="h2" />

You now have wallet connection and basic user data (address, network, balance, ENS) in your dApp. In **Part 2**, we’ll cover more advanced features and refine your Web3/Frontend setup.
